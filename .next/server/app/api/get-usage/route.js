"use strict";(()=>{var e={};e.id=5688,e.ids=[5688],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},61212:e=>{e.exports=require("async_hooks")},78893:e=>{e.exports=require("buffer")},3199:e=>{e.exports=require("console")},84770:e=>{e.exports=require("crypto")},27920:e=>{e.exports=require("diagnostics_channel")},17702:e=>{e.exports=require("events")},32615:e=>{e.exports=require("http")},32694:e=>{e.exports=require("http2")},98216:e=>{e.exports=require("net")},96119:e=>{e.exports=require("perf_hooks")},86624:e=>{e.exports=require("querystring")},76162:e=>{e.exports=require("stream")},66083:e=>{e.exports=require("stream/web")},74026:e=>{e.exports=require("string_decoder")},82452:e=>{e.exports=require("tls")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},61814:e=>{e.exports=require("util/types")},6162:e=>{e.exports=require("worker_threads")},71568:e=>{e.exports=require("zlib")},6005:e=>{e.exports=require("node:crypto")},15673:e=>{e.exports=require("node:events")},87561:e=>{e.exports=require("node:fs")},49411:e=>{e.exports=require("node:path")},84492:e=>{e.exports=require("node:stream")},47261:e=>{e.exports=require("node:util")},20290:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>y,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>x,staticGenerationAsyncStorage:()=>f});var n={};r.r(n),r.d(n,{GET:()=>c});var i=r(49303),a=r(88716),s=r(60670),o=r(72441),u=r(24910),p=r(85053);async function c(e){let{searchParams:t}=new URL(e.url),r=t.get("tier")||"free";try{let e=await (0,u.I)();if(e.userId){let t=e.orgId;r=await (0,p.dC)(e.userId,t)||r;let n=await (0,o.X9)(e.userId),i=(0,o.Ti)(r);return new Response(JSON.stringify({ok:!0,tier:r,limit:i,used:n.used}),{headers:{"Content-Type":"application/json"}})}}catch{}let n=(0,o.Ti)(r);return new Response(JSON.stringify({ok:!0,tier:r,limit:n,used:0}),{headers:{"Content-Type":"application/json"}})}let d=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/get-usage/route",pathname:"/api/get-usage",filename:"route",bundlePath:"app/api/get-usage/route"},resolvedPagePath:"/Users/home/dev/ABA-tool/app/api/get-usage/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:l,staticGenerationAsyncStorage:f,serverHooks:x}=d,g="/api/get-usage/route";function y(){return(0,s.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:f})}},72441:(e,t,r)=>{r.d(t,{Ti:()=>s,iS:()=>p,X9:()=>o});var n=r(12757);let i=[{id:"free",name:"Discovery",priceMonthly:0,analysesPerMonth:5,features:["1 saved plan","Community resources"]},{id:"individual",name:"Individual",priceMonthly:9,analysesPerMonth:50,features:["5 active plans","Export & share"]},{id:"clinician",name:"Clinician",priceMonthly:29,analysesPerMonth:300,features:["Client folders","Templates","CSV export"]},{id:"clinic",name:"Clinic / Team",priceMonthly:119,analysesPerMonth:1500,seats:5,features:["Pooled usage","Roles & permissions"]},{id:"enterprise",name:"Enterprise",priceMonthly:"contact",features:["SSO","BAA addendum","Priority support"]}];function a(e=new Date){let t=e.getUTCFullYear(),r=String(e.getUTCMonth()+1).padStart(2,"0");return`${t}-${r}`}function s(e){let t=i.find(t=>t.id===e);return t?t.analysesPerMonth??5:5}async function o(e){let t=a(),r=`usage/${t}/${e}.json`,{blobs:i}=await (0,n.pb)({prefix:r}),s=i.find(e=>e.pathname===r);if(!s)return{used:0,updatedAt:Date.now()};try{let e=await fetch(s.url),t=await e.json();return{used:Number(t.used||0),updatedAt:Number(t.updatedAt||Date.now())}}catch{return{used:0,updatedAt:Date.now()}}}async function u(e,t){let r=a(),i=`usage/${r}/${e}.json`;await (0,n.gz)(i,JSON.stringify(t),{access:"public",contentType:"application/json",addRandomSuffix:!1})}async function p(e,t=1){let r={used:(await o(e)).used+t,updatedAt:Date.now()};return await u(e,r),r}},85053:(e,t,r)=>{r.d(t,{dC:()=>s,gB:()=>o,lX:()=>u});var n=r(12757);function i(e){return`billing/users/${e}.json`}function a(e){return`billing/orgs/${e}.json`}async function s(e,t){if(t){let e=a(t),r=(await (0,n.pb)({prefix:e})).blobs.find(t=>t.pathname===e);if(r)try{let e=await fetch(r.url),t=await e.json();if(t?.status==="active"&&"string"==typeof t?.tier)return t.tier}catch{}}let r=i(e),s=(await (0,n.pb)({prefix:r})).blobs.find(e=>e.pathname===r);if(!s)return"free";try{let e=await fetch(s.url),t=await e.json();if(t?.status==="active"&&"string"==typeof t?.tier)return t.tier}catch{}return"free"}async function o(e,t,r="active",a){let s={tier:t,status:r,updatedAt:Date.now(),orgId:a};await (0,n.gz)(i(e),JSON.stringify(s),{access:"public",contentType:"application/json",addRandomSuffix:!1})}async function u(e,t,r="active"){let i={tier:t,status:r,updatedAt:Date.now(),orgId:e};await (0,n.gz)(a(e),JSON.stringify(i),{access:"public",contentType:"application/json",addRandomSuffix:!1})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[8948,4910,6842],()=>r(20290));module.exports=n})();