"use strict";(()=>{var e={};e.id=1525,e.ids=[1525],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},61212:e=>{e.exports=require("async_hooks")},78893:e=>{e.exports=require("buffer")},3199:e=>{e.exports=require("console")},84770:e=>{e.exports=require("crypto")},27920:e=>{e.exports=require("diagnostics_channel")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},32694:e=>{e.exports=require("http2")},35240:e=>{e.exports=require("https")},98216:e=>{e.exports=require("net")},55315:e=>{e.exports=require("path")},96119:e=>{e.exports=require("perf_hooks")},68621:e=>{e.exports=require("punycode")},86624:e=>{e.exports=require("querystring")},76162:e=>{e.exports=require("stream")},66083:e=>{e.exports=require("stream/web")},74026:e=>{e.exports=require("string_decoder")},82452:e=>{e.exports=require("tls")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},61814:e=>{e.exports=require("util/types")},6162:e=>{e.exports=require("worker_threads")},71568:e=>{e.exports=require("zlib")},6005:e=>{e.exports=require("node:crypto")},15673:e=>{e.exports=require("node:events")},87561:e=>{e.exports=require("node:fs")},49411:e=>{e.exports=require("node:path")},84492:e=>{e.exports=require("node:stream")},72477:e=>{e.exports=require("node:stream/web")},47261:e=>{e.exports=require("node:util")},33062:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>g,requestAsyncStorage:()=>h,routeModule:()=>y,serverHooks:()=>m,staticGenerationAsyncStorage:()=>x});var i={};r.r(i),r.d(i,{POST:()=>f,dynamic:()=>l,runtime:()=>d});var s=r(49303),n=r(88716),a=r(60670),o=r(24910),u=r(72441),p=r(85053),c=r(73966);let d="nodejs",l="force-dynamic";async function f(e){let{title:t="Say hello",interests:r=["drawing"]}=await e.json().catch(()=>({}));try{let e=await (0,o.I)();if(e.userId){let t=await (0,p.dC)(e.userId,e.orgId),r=(0,u.Ti)(t),i=await (0,u.X9)(e.userId);if(i.used>=r)return new Response(JSON.stringify({ok:!1,error:"limit_exceeded",limit:r,used:i.used}),{status:429,headers:{"Content-Type":"application/json"}})}}catch{}if(process.env.ANTHROPIC_API_KEY)try{let e=new c.ZP({apiKey:process.env.ANTHROPIC_API_KEY}),i=`You are an ABA-informed assistant following BACB ethics: prioritize assent, autonomy, and dignity; avoid coercion or aversives. Generate a short 5-step social pathway for the goal "${t}" using interests ${JSON.stringify(r)}. Output STRICT JSON: {"steps":[{"order":1,"instruction":"...","tip":"..."}, ...]}.`,s=await e.messages.create({model:process.env.ANTHROPIC_MODEL_HAIKU||"claude-3-haiku-20240307",max_tokens:300,temperature:.4,messages:[{role:"user",content:i}]}),n=s.content[0]?.text||"{}",a=JSON.parse(n);if(a?.steps?.length){try{let e=await (0,o.I)();e.userId&&await (0,u.iS)(e.userId,1)}catch{}return new Response(JSON.stringify({ok:!0,title:t,steps:a.steps}),{headers:{"Content-Type":"application/json"}})}}catch(e){}let i=[{order:1,instruction:`Pick a place related to ${r[0]||"an interest"}`,tip:"Small, predictable venues work best"},{order:2,instruction:"Go during a quiet time",tip:"Lower sensory load = easier first reps"},{order:3,instruction:`Bring a small prop about ${r[0]||"your interest"}`,tip:"Props make openings easier"},{order:4,instruction:"Give a short hello + one line about your prop",tip:"End on success, do not force"},{order:5,instruction:"Log how it felt and one improvement for next time"}];try{let e=await (0,o.I)();e.userId&&await (0,u.iS)(e.userId,1)}catch{}return new Response(JSON.stringify({ok:!0,title:t,steps:i}),{headers:{"Content-Type":"application/json"}})}let y=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/pathways/route",pathname:"/api/pathways",filename:"route",bundlePath:"app/api/pathways/route"},resolvedPagePath:"/Users/home/dev/ABA-tool/app/api/pathways/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:h,staticGenerationAsyncStorage:x,serverHooks:m}=y,w="/api/pathways/route";function g(){return(0,a.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:x})}},72441:(e,t,r)=>{r.d(t,{Ti:()=>a,iS:()=>p,X9:()=>o});var i=r(12757);let s=[{id:"free",name:"Discovery",priceMonthly:0,analysesPerMonth:5,features:["1 saved plan","Community resources"]},{id:"individual",name:"Individual",priceMonthly:9,analysesPerMonth:50,features:["5 active plans","Export & share"]},{id:"clinician",name:"Clinician",priceMonthly:29,analysesPerMonth:300,features:["Client folders","Templates","CSV export"]},{id:"clinic",name:"Clinic / Team",priceMonthly:119,analysesPerMonth:1500,seats:5,features:["Pooled usage","Roles & permissions"]},{id:"enterprise",name:"Enterprise",priceMonthly:"contact",features:["SSO","BAA addendum","Priority support"]}];function n(e=new Date){let t=e.getUTCFullYear(),r=String(e.getUTCMonth()+1).padStart(2,"0");return`${t}-${r}`}function a(e){let t=s.find(t=>t.id===e);return t?t.analysesPerMonth??5:5}async function o(e){let t=n(),r=`usage/${t}/${e}.json`,{blobs:s}=await (0,i.pb)({prefix:r}),a=s.find(e=>e.pathname===r);if(!a)return{used:0,updatedAt:Date.now()};try{let e=await fetch(a.url),t=await e.json();return{used:Number(t.used||0),updatedAt:Number(t.updatedAt||Date.now())}}catch{return{used:0,updatedAt:Date.now()}}}async function u(e,t){let r=n(),s=`usage/${r}/${e}.json`;await (0,i.gz)(s,JSON.stringify(t),{access:"public",contentType:"application/json",addRandomSuffix:!1})}async function p(e,t=1){let r={used:(await o(e)).used+t,updatedAt:Date.now()};return await u(e,r),r}},85053:(e,t,r)=>{r.d(t,{dC:()=>a,gB:()=>o,lX:()=>u});var i=r(12757);function s(e){return`billing/users/${e}.json`}function n(e){return`billing/orgs/${e}.json`}async function a(e,t){if(t){let e=n(t),r=(await (0,i.pb)({prefix:e})).blobs.find(t=>t.pathname===e);if(r)try{let e=await fetch(r.url),t=await e.json();if(t?.status==="active"&&"string"==typeof t?.tier)return t.tier}catch{}}let r=s(e),a=(await (0,i.pb)({prefix:r})).blobs.find(e=>e.pathname===r);if(!a)return"free";try{let e=await fetch(a.url),t=await e.json();if(t?.status==="active"&&"string"==typeof t?.tier)return t.tier}catch{}return"free"}async function o(e,t,r="active",n){let a={tier:t,status:r,updatedAt:Date.now(),orgId:n};await (0,i.gz)(s(e),JSON.stringify(a),{access:"public",contentType:"application/json",addRandomSuffix:!1})}async function u(e,t,r="active"){let s={tier:t,status:r,updatedAt:Date.now(),orgId:e};await (0,i.gz)(n(e),JSON.stringify(s),{access:"public",contentType:"application/json",addRandomSuffix:!1})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[8948,4910,6842,3966],()=>r(33062));module.exports=i})();